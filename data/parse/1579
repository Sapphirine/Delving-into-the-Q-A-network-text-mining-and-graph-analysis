relev sourc code m pretti sure use cross entropi multiclass gbm greg ridgeway copyright c 2003 includ multinomi h cmultinomi cmultinomi int cnumclass int crow mcnumclass cnumclass mcrow crow madprob new doubl cnumclass crow cmultinomi cmultinomi madprob ! null delet madprob gbmresult cmultinomi updateparam doubl adf doubl adoffset doubl adweight unsign long clength local variabl unsign long ii 0 unsign long kk 0 set probabl observ class ii 0 ii mcrow ii doubl dclasssum 0 0 kk 0 kk mcnumclass kk int iidx ii kk mcrow doubl df adoffset null ? adf iidx adf iidx adoffset iidx madprob iidx adweight iidx exp df dclasssum adweight iidx exp df dclasssum dclasssum 0 ? dclasssum 1e 8 kk 0 kk mcnumclass kk madprob ii kk mcrow dclasssum return gbm ok gbmresult cmultinomi computeworkingrespons doubl adi doubl admisc doubl adoffset doubl adf doubl adz doubl adweight bool afinbag unsign long ntrain int cidxoff unsign long 0 cidxoff ntrain cidxoff adz adi madprob return gbm ok gbmresult cmultinomi initf doubl adi doubl admisc doubl adoffset doubl adweight doubl dinitf unsign long clength dinitf 0 0 return gbm ok doubl cmultinomi devianc doubl adi doubl admisc doubl adoffset doubl adweight doubl adf unsign long clength int cidxoff unsign long ii 0 doubl dl 0 0 doubl dw 0 0 ii cidxoff ii clength cidxoff ii dl adweight ii adi ii log madprob ii dw adweight ii return dl dw gbmresult cmultinomi fitbestconst doubl adi doubl admisc doubl adoffset doubl adw doubl adf doubl adz unsign long ainodeassign unsign long ntrain vec p nodetermin vecptermnod unsign long ctermnod unsign long cminobsinnod bool afinbag doubl adfadj int cidxoff local variabl gbmresult hr gbm ok unsign long inod 0 unsign long iob 0 call locm array valu node inod 0 inod ctermnod inod vecptermnod inod cn cminobsinnod get number node doubl dnum 0 0 doubl ddenom 0 0 iob 0 iob ntrain iob afinbag iob ainodeassign iob inod int iidx iob cidxoff dnum adw iidx adz iidx ddenom adw iidx fab adz iidx 1 fab adz iidx ddenom ddenom 0 ? ddenom 1e 8 vecptermnod inod dpredict dnum ddenom return hr doubl cmultinomi bagimprov doubl adi doubl admisc doubl adoffset doubl adweight doubl adf doubl adfadj bool afinbag doubl dstepsiz unsign long ntrain doubl dreturnvalu 0 0 doubl dw 0 0 unsign long ii unsign long kk calcul probabl step doubl adstepprob new doubl mcnumclass mcrow assum last class calcul new prob updateparam use f ik ss fadj ik instead f ik calcul oob improv ii 0 ii mcrow ii doubl dclasssum 0 0 kk 0 kk mcnumclass kk int iidx ii kk mcrow doubl df adoffset null ? adf iidx adf iidx adoffset iidx df dstepsiz adfadj iidx adstepprob iidx adweight iidx exp df dclasssum adweight iidx exp df dclasssum dclasssum 0 ? dclasssum 1e 8 kk 0 kk mcnumclass kk adstepprob ii kk mcrow dclasssum calcul improv ii 0 ii ntrain ii !afinbag ii kk 0 kk mcnumclass kk int iidx ii kk mcrow dreturnvalu adweight iidx adi iidx log adstepprob iidx log madprob iidx dw adweight iidx adi iidx return dreturnvalu dw